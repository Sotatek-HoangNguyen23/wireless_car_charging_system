@page
@model wireless_changing_system.Pages.Wireless_charging.ChargingStation.StationDetailModel
@{
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Station Detail</title>
    <link rel="stylesheet" href="~/css/chargingstation/detail.css"> 
</head>
<body>
    <div class="container">
        <!-- Header với ảnh và thông tin trạm sạc -->
        <div class="station-header">
            <img src="https://img.canarymedia.com/content/uploads/witricity3.png?auto=compress%2Cformat&crop=focalpoint&fit=crop&fp-x=0.5&fp-y=0.5&h=501&q=80&w=864&s=8fb2e832892760cff6912e6683a67514" alt="Station Image">
            <div class="station-info">
                
            </div>
        </div>

        <!-- Charging Points -->
        <div class="charging-points">
            <h3>Charging Points</h3>
            <div class="row">
                
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Lấy stationId từ URL hoặc đặt mặc định
            const urlParams = new URLSearchParams(window.location.search);
            const stationId = urlParams.get('stationId'); // Mặc định ID = 2

            // Gọi API lấy thông tin trạm sạc
            $.ajax({
                url: `https://localhost:7191/api/ChargingStation/Detail/${stationId}`,
                method: "GET",
                dataType: "json",
                success: function (data) {
                    console.log("API Response:", data);
                    updateStationInfo(data);
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching station data:", error);
                    alert("Không thể tải dữ liệu trạm sạc.");
                }
            });

            // Hàm cập nhật thông tin trạm sạc vào HTML
            function updateStationInfo(data) {
                if (!data || !data.station) return;

                let station = data.station;
                let points = data.points;

                // Cập nhật thông tin trạm sạc
                $(".station-info").html(`
                        <h1>${station.stationName}</h1>
                        <p><strong>Owner:</strong> ${station.owner}</p>
                        <p><strong>Total Charging Point:</strong> ${station.totalPoint}</p>
                        <p><strong>Empty Charging Point:</strong> ${station.availablePoint}</p>
                        <p><strong>Address:</strong> ${station.address}</p>
                        <p><strong>Status:</strong> ${station.status}</p>
                        <button class="btn btn-warning btn-sm show-on-map" data-lat="${station.latitude}" data-lng="${station.longtitude}">
                        Show on Map
                        </button>
                    `);

                // Gán sự kiện click cho nút "Show on Map"
                $(".show-on-map").click(function () {
                    const lat = $(this).data("lat");
                    const lng = $(this).data("lng");
                    openGoogleMaps(lat, lng);
                });

                // Cập nhật danh sách điểm sạc
                let pointHTML = '';
                points.forEach(point => {
                    let statusClass = getStatusClass(point.status);
                    pointHTML += `
                            <div class="col-md-4">
                                <div class="point-card">
                                    <h5>${point.chargingPointName}</h5>
                                    <p>
                                        <strong>Status:</strong> ${point.status}
                                        <span class="status-dot ${statusClass}"></span>
                                    </p>
                                    <p><strong>Max power:</strong> ${point.maxPower}</p>
                                    <p><strong>Description:</strong> ${point.description}</p>
                                </div>                              
                            </div>
                        `;
                });

                $(".charging-points .row").html(pointHTML);                
            }

            function openGoogleMaps(lat, lng) {
                const googleMapsUrl = `https://www.google.com/maps?q=${lat},${lng}`;
                window.open(googleMapsUrl, "_blank"); // Mở Google Maps trong tab mới
            }

            // Hàm đổi màu trạng thái
            function getStatusClass(status) {
                switch (status.toLowerCase()) {
                    case "available":
                        return "available";  // Xanh lá
                    case "in use":
                        return "in-use";     // Đỏ
                    case "maintenance":
                        return "maintenance"; // Vàng
                    default:
                        return "";
                }
            }

        });
    </script>

</body>
</html>